<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>여행객 혼잡도 지도</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdzoAa5qdInQ1YuXV97hfWrxfE_y9rN3o&callback=initMap">
  </script>
  <style>
    body { margin: 0; background-color: #121212; color: white; font-family: 'Segoe UI', sans-serif; }
    header { background: #1e1e1e; padding: 1rem; text-align: center; font-size: 1.5rem; font-weight: bold; }
    .top-bar {
      display: flex; justify-content: center; gap: 1rem; padding: 0.5rem; background: #1e1e1e;
    }
    .main-content { display: none; height: calc(100vh - 60px); }
    #map { flex: 2; height: 100%; }
    .sidebar {
      flex: 1; background: #1e1e1e; padding: 1rem; display: flex; flex-direction: column;
      justify-content: space-between; border-left: 1px solid #333;
    }
    .legend-item { display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0; }
    .legend-color { width: 16px; height: 16px; border-radius: 50%; }
    .low { background-color: green; } .medium { background-color: orange; } .high { background-color: red; }
    input, button {
      padding: 0.5rem; margin: 0.3rem 0; width: 90%;
    }
    #signupBox, #loginBox {
      display: none; margin: 1rem auto; background: #2a2a2a; padding: 1rem; border-radius: 8px;
      width: 300px; transition: all 0.3s ease-in-out; opacity: 0; transform: scale(0.95);
    }
    #signupBox.show, #loginBox.show {
      display: block; opacity: 1; transform: scale(1);
    }
    .user-info { font-weight: bold; margin-bottom: 1rem; color: lightgreen; text-align: center; }
    .slider-container { margin: 1rem 0; }
    .slider-container label { display: block; margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <header>여행객 혼잡도 지도</header>

  <!-- 버튼 영역 -->
  <div class="top-bar" id="buttonArea">
    <button onclick="toggleBox('signupBox')">회원가입</button>
    <button onclick="toggleBox('loginBox')">로그인</button>
  </div>

  <!-- 회원가입 상자 -->
  <div id="signupBox">
    <h3>회원가입</h3>
    <input type="text" placeholder="아이디" id="signupId" />
    <input type="password" placeholder="비밀번호" id="signupPw" />
    <button onclick="signupUser()">가입하기</button>
  </div>

  <!-- 로그인 상자 -->
  <div id="loginBox">
    <h3>로그인</h3>
    <input type="text" placeholder="아이디" id="loginUser" />
    <input type="password" placeholder="비밀번호" id="loginPw" />
    <button onclick="loginUser(document.getElementById('loginUser').value)">로그인</button>
  </div>

  <!-- 메인 콘텐츠 (지도 포함) -->
  <div class="main-content" id="mainContent">
    <div id="map"></div>
    <div class="sidebar">
      <div>
        <div class="user-info" id="userInfo"></div>
        <div class="slider-container">
          <label for="congestionSlider">혼잡도 조절</label>
          <input type="range" min="1" max="3" value="2" id="congestionSlider" onchange="updateCongestion()">
          <div id="congestionLevel" style="margin-top: 0.5rem;">중간</div>
        </div>

        <div class="legend-item"><div class="legend-color low"></div><span>낮음</span></div>
        <div class="legend-item"><div class="legend-color medium"></div><span>중간</span></div>
        <div class="legend-item"><div class="legend-color high"></div><span>높음</span></div>
      </div>

      <button onclick="logoutUser()">로그아웃</button>
    </div>
  </div>

  <script>
    let loggedIn = false;
    let map;
    let marker;

    function toggleBox(id) {
      const box = document.getElementById(id);
      const isShown = box.classList.contains('show');
      document.querySelectorAll('#signupBox, #loginBox').forEach(el => el.classList.remove('show'));
      if (!isShown) box.classList.add('show');
    }

    function signupUser() {
      const id = document.getElementById('signupId').value;
      const pw = document.getElementById('signupPw').value;
      if (id && pw) {
        alert('회원가입 완료! 로그인해주세요.');
        document.getElementById('signupBox').classList.remove('show');
      } else {
        alert('아이디와 비밀번호를 입력하세요.');
      }
    }

    function loginUser(username) {
      if (username) {
        loggedIn = true;
        alert(username + '님 환영합니다!');
        document.getElementById('userInfo').innerText = `${username} 님`;
        document.getElementById('mainContent').style.display = 'flex';
        document.getElementById('signupBox').style.display = 'none';
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('buttonArea').style.display = 'none';

        if (typeof google !== 'undefined') {
          initMap();
        }
      } else {
        alert('아이디를 입력하세요.');
      }
    }

    function logoutUser() {
      loggedIn = false;
      alert('로그아웃되었습니다.');
      document.getElementById('mainContent').style.display = 'none';
      document.getElementById('buttonArea').style.display = 'flex';
      document.getElementById('userInfo').innerText = '';
    }

    function updateCongestion() {
      const value = parseInt(document.getElementById('congestionSlider').value);
      const levelText = { 1: '낮음', 2: '중간', 3: '높음' };
      document.getElementById('congestionLevel').innerText = levelText[value];

      if (marker) {
        const colorMap = {
          1: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
          2: 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png',
          3: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
        };
        marker.setIcon(colorMap[value]);
      }
    }

    function initMap() {
      const seoul = { lat: 37.5665, lng: 126.9780 };
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 12,
        center: seoul,
      });

      marker = new google.maps.Marker({
        position: seoul,
        map,
        title: "서울 중심",
        icon: 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png' // 중간 기본값
      });
    }
  </script>
</body>
</html>
